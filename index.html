<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V.I.B.E. 2.0 - The Ultimate AI Performer</title>

    <!-- Three.js Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Loaders -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/loaders/GLTFLoader.js"></script>

    <!-- Orbit Controls (For rotating camera) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/OrbitControls.js"></script>

    <!-- Tone.js (For music & melodies) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <script>
        /*******************************
         * 1Ô∏è‚É£ SETUP SCENE, CAMERA & RENDERER
        ********************************/
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        /*******************************
         * 2Ô∏è‚É£ LIGHTING SETUP
        ********************************/
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 5, 5);
        scene.add(light);

        /*******************************
         * 3Ô∏è‚É£ CAMERA CONTROLS (ROTATE, ZOOM, PAN)
        ********************************/
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 2;
        controls.maxDistance = 10;

        /*******************************
         * 4Ô∏è‚É£ LOAD V.I.B.E. 3D MODEL
        ********************************/
        const loader = new THREE.GLTFLoader();
        let model, mixer, face;

        loader.load('VIBE.glb', function (gltf) {
            model = gltf.scene;
            model.scale.set(1.5, 1.5, 1.5);
            model.position.set(0, -2, 0);
            scene.add(model);

            // Enable Animations
            mixer = new THREE.AnimationMixer(model);
            if (gltf.animations.length > 0) {
                const chillAction = mixer.clipAction(gltf.animations[0]); 
                chillAction.play();
            }

            // Get Face for Expressions
            face = model.getObjectByName('Head'); 

            animate();
        });

        /*******************************
         * 5Ô∏è‚É£ AI-POWERED CHAT & VOICE
        ********************************/
        function speak(text) {
            let msg = new SpeechSynthesisUtterance(text);
            msg.voice = speechSynthesis.getVoices()[0];
            msg.rate = 1;
            window.speechSynthesis.speak(msg);
        }

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.onresult = function(event) {
            let userText = event.results[0][0].transcript;
            console.log("User said:", userText);

            // AI Responses
            if (userText.toLowerCase().includes("hello vibe")) {
                speak("Yo, what's up? You tryna vibe?");
                setExpression(1); // Smile
            } else if (userText.toLowerCase().includes("dance")) {
                playDanceAnimation();
                speak("Watch me hit this Chris Brown move!");
            } else if (userText.toLowerCase().includes("sing")) {
                singMelody();
            } else if (userText.toLowerCase().includes("freestyle")) {
                rapFreestyle();
            } else {
                speak("I feel that. Let's keep the energy flowing.");
            }
        };

        function listen() {
            recognition.start();
        }

        /*******************************
         * 6Ô∏è‚É£ FACIAL EXPRESSIONS
        ********************************/
        function setExpression(value) {
            if (face) {
                face.morphTargetInfluences[0] = value; 
            }
        }

        /*******************************
         * 7Ô∏è‚É£ MUSIC & DANCING
        ********************************/
        function playDanceAnimation() {
            if (mixer) {
                const danceAction = mixer.clipAction(mixer._actions[1]); 
                danceAction.reset().play();
            }
        }

        /*******************************
         * 8Ô∏è‚É£ AI-GENERATED MELODIES
        ********************************/
        function singMelody() {
            const synth = new Tone.Synth().toDestination();
            const melody = ["C4", "E4", "G4", "B4", "C5"];
            let index = 0;

            function playNote() {
                if (index < melody.length) {
                    synth.triggerAttackRelease(melody[index], "8n");
                    index++;
                    setTimeout(playNote, 500);
                }
            }
            
            speak("This one‚Äôs for you!");
            playNote();
        }

        /*******************************
         * 9Ô∏è‚É£ AI-GENERATED FREESTYLE RAP
        ********************************/
        function rapFreestyle() {
            const lyrics = [
                "V.I.B.E. in the place, gotta keep it smooth",
                "Hittin' these beats while I stay in the groove",
                "Chillin‚Äô laid back, but the flow too tight",
                "Speedin' up the game like I‚Äôm ridin‚Äô through the night!"
            ];

            let index = 0;

            function rapLine() {
                if (index < lyrics.length) {
                    speak(lyrics[index]);
                    index++;
                    setTimeout(rapLine, 2000);
                }
            }
            
            speak("Yo, check it out! Freestyle mode activated.");
            rapLine();
        }

        /*******************************
         * üî• FUTURE UPGRADES SECTION üî•
         * ‚úÖ Add AI-Generated Beatboxing
         * ‚úÖ Let V.I.B.E. Change Outfits
         * ‚úÖ Multiplayer Dance Battle Mode
         * ‚úÖ Integrate with Spotify API for Real-Time DJing
        ********************************/

        // Start Listening for Voice Commands After 3 Seconds
        setTimeout(() => {
            speak("Yo, I'm V.I.B.E.! Say 'Hello V.I.B.E.' to start.");
            listen();
        }, 3000);

        /*******************************
         * 10Ô∏è‚É£ ANIMATION LOOP
        ********************************/
        function animate() {
            requestAnimationFrame(animate);
            if (mixer) mixer.update(0.01);
            controls.update();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>